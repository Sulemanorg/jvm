# 1. 程序计数器介绍（PC  Register）

- JVM中的寄存器是对物理PC寄存器的一种抽象模拟
- 作用：PC寄存器用来存储指向下一条指令的地址，也就是即将要执行的指令代码。由执行引擎读取下一条指令
- 它是一块很小的内存空间，几乎可以忽略不计。也是运行速度最快的存储区域
- 在JVM规范中，每个线程都有它自己的程序计数器，是线程私有的，生命周期与线程的生命周期保持一致
- 任何时间一个线程都只有一个方法在执行，也就是所谓的当前方法。程序计数器会存储当前线程正在执行的Java方法的JVM指令地址；或者，如果在执行navite方法，则是未指定值（undefined）
- 它是程序控制流的指示器，分支、循环、跳转、异常处理、线程恢复等基础功能都需要依赖这个计数器完成
- 字节码解释器工作时就是通过改变这个计数器的值来选取下一条要执行的字节码指令
- 它是唯一一个在Java虚拟机规范中没有规定任何OutofMemoryError情况的区域

<img src="https://raw.githubusercontent.com/Sulemanorg/jvm/master/img/20200708222729.png" alt="image-20200708222729856" style="zoom:80%;" />

<img src="https://raw.githubusercontent.com/Sulemanorg/jvm/master/img/20200708222830.png" alt="image-20200708222830058" style="zoom:80%;" />

# 2. 使用举例

<img src="https://raw.githubusercontent.com/Sulemanorg/jvm/master/img/20200709100442.png" alt="image-20200709100442265"  />

# 3. 两个常见问题

## 3.1  使用PC寄存器存储字节码指令地址有什么用？为什么使用使用程序计数器记录当前线程执行地址？

- 因为CPU需要不停的切换各个线程，这时候切换回来，就得知道接着从哪开始继续执行
- JVM的字节码解释器就需要通过改变PC寄存器的值来明确下一条应该执行什么样的字节码指令

![image-20200709101431981](https://raw.githubusercontent.com/Sulemanorg/jvm/master/img/20200709101432.png)

## 3.2  PC寄存器为什么会被设定为线程私有？

- 我们都知道所谓的多线程在一个特定的时间段内只会执行其中某一个线程的方法，CPU会不停的做任务切换，这样必然导致经常中断或恢复，如何保证分毫不差呢？**为了能够准却地记录各个线程正在执行的当前字节码指令地址，最好的办法自然是为每一个线程都分配一个PC寄存器**，这样一来各个线程之间便可以进行独立计算，从而不会出现相互干扰的情况
- 由于CPU时间片轮限制，众多线程在并发执行的过程中，任何一个确定的时刻，一个处理器或多核处理器中的一个内核，只会执行某个线程中的一条指令，这样必然导致经常中断或恢复，如何保证分毫不差？每个线程在创建后，都会产生自己的程序计数器和栈帧，程序计数器在各个线程之间互不影响

<img src="https://raw.githubusercontent.com/Sulemanorg/jvm/master/img/20200709103049.png" alt="image-20200709103049793" style="zoom:80%;" />

